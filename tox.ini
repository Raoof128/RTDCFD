[tox]
envlist = py38, py39, py310, py311, py312, flake8, mypy, security, docs, coverage
isolated_build = true

[testenv]
deps = pytest>=7.4.0
       pytest-asyncio>=0.21.0
       pytest-mock>=3.12.0
       pytest-cov>=4.1.0
commands = pytest {posargs}
pass_env = ANTHROPIC_API_KEY

[testenv:unit]
deps = {[testenv]deps}
commands = pytest tests/test_scenarios.py tests/test_basic_functionality.py -v

[testenv:integration]
deps = {[testenv]deps}
commands = pytest tests/test_config.py -v

[testenv:all]
deps = {[testenv]deps}
commands = pytest tests/ -v

[testenv:coverage]
deps = {[testenv]deps}
commands = pytest --cov=agents --cov=orchestration --cov=utils --cov=scenarios --cov=dashboard --cov=mcp_servers --cov-report=html --cov-report=term-missing

[testenv:flake8]
deps = flake8>=6.0.0
commands = flake8 agents/ orchestration/ utils/ scenarios/ dashboard/ mcp_servers/ --max-line-length=88 --extend-ignore=E203,W503,E501

[testenv:mypy]
deps = mypy>=1.7.0
       types-all
commands = mypy agents/ orchestration/ utils/ scenarios/ dashboard/ mcp_servers/ --ignore-missing-imports

[testenv:security]
deps = bandit>=1.7.0
       safety>=2.3.0
commands = 
    bandit -r agents/ orchestration/ utils/ scenarios/ dashboard/ mcp_servers/
    safety check

[testenv:docs]
deps = sphinx>=7.1.0
       sphinx-rtd-theme>=1.3.0
       myst-parser>=2.0.0
commands = sphinx-build -b html docs/ docs/_build/html

[testenv:lint]
deps = black>=23.0.0
       isort>=5.12.0
       flake8>=6.0.0
       mypy>=1.7.0
commands = 
    black --check agents/ orchestration/ utils/ scenarios/ dashboard/ mcp_servers/
    isort --check-only agents/ orchestration/ utils/ scenarios/ dashboard/ mcp_servers/
    flake8 agents/ orchestration/ utils/ scenarios/ dashboard/ mcp_servers/ --max-line-length=88 --extend-ignore=E203,W503,E501
    mypy agents/ orchestration/ utils/ scenarios/ dashboard/ mcp_servers/ --ignore-missing-imports

[testenv:format]
deps = black>=23.0.0
       isort>=5.12.0
commands = 
    black agents/ orchestration/ utils/ scenarios/ dashboard/ mcp_servers/
    isort agents/ orchestration/ utils/ scenarios/ dashboard/ mcp_servers/

[testenv:quality]
deps = {[testenv:security]deps}
       {[testenv:lint]deps}
       radon>=6.0.0
       pydocstyle>=6.3.0
commands = 
    {[testenv:security]commands}
    {[testenv:lint]commands}
    radon cc --min B agents/ orchestration/ utils/ scenarios/ dashboard/ mcp_servers/
    pydocstyle --convention=google agents/ orchestration/ utils/ scenarios/ dashboard/ mcp_servers/

[testenv:clean]
deps = 
commands = 
    find . -type d -name __pycache__ -delete
    find . -type f -name "*.pyc" -delete
    find . -type f -name "*.pyo" -delete
    find . -type f -name ".coverage" -delete
    rm -rf .pytest_cache/
    rm -rf htmlcov/
    rm -rf .mypy_cache/
    rm -rf .tox/
    rm -rf build/
    rm -rf dist/
    rm -rf *.egg-info/

[testenv:build]
deps = build>=0.10.0
       twine>=4.0.0
commands = 
    python -m build
    twine check dist/*

[testenv:install-dev]
deps = -e .[dev]
commands = pip install -e .[dev]

[testenv:validate]
deps = {[testenv:all]deps}
       {[testenv:quality]deps}
commands = 
    {[testenv:all]commands}
    {[testenv:quality]commands}

# Python version specific environments
[testenv:py38]
base_python = python3.8
deps = {[testenv]deps}

[testenv:py39]
base_python = python3.9
deps = {[testenv]deps}

[testenv:py310]
base_python = python3.10
deps = {[testenv]deps}

[testenv:py311]
base_python = python3.11
deps = {[testenv]deps}

[testenv:py312]
base_python = python3.12
deps = {[testenv]deps}

# Performance testing
[testenv:perf]
deps = pytest>=7.4.0
       pytest-benchmark>=4.0.0
commands = pytest --benchmark-only tests/

# Documentation testing
[testenv:docs-test]
deps = sphinx>=7.1.0
       doc8>=1.1.1
commands = 
    sphinx-build -b html docs/ docs/_build/html
    doc8 docs/

# Security scanning
[testenv:security-full]
deps = bandit>=1.7.0
       safety>=2.3.0
       pip-audit>=2.6.0
       semgrep>=1.34.0
commands = 
    bandit -r agents/ orchestration/ utils/ scenarios/ dashboard/ mcp_servers/
    safety check
    pip-audit
    semgrep --config=.semgrep.yml agents/ orchestration/ utils/ scenarios/ dashboard/ mcp_servers/

# Code complexity analysis
[testenv:complexity]
deps = radon>=6.0.0
       xenon>=0.9.0
commands = 
    radon cc --min B agents/ orchestration/ utils/ scenarios/ dashboard/ mcp_servers/
    xenon --max-absolute B agents/ orchestration/ utils/ scenarios/ dashboard/ mcp_servers/

# Type checking with strict settings
[testenv:mypy-strict]
deps = mypy>=1.7.0
       types-all
commands = mypy agents/ orchestration/ utils/ scenarios/ dashboard/ mcp_servers/ --strict

# Integration testing with external dependencies
[testenv:integration-full]
deps = {[testenv:integration]deps}
       httpx>=0.26.0
       requests-mock>=1.11.0
commands = pytest tests/test_integration/ -v

# Performance profiling
[testenv:profile]
deps = pytest>=7.4.0
       pytest-profiling>=1.7.0
commands = pytest --profile tests/ --profile-svg

# Parallel testing
[testenv:parallel]
deps = pytest>=7.4.0
       pytest-xdist>=3.3.0
commands = pytest -n auto tests/

# Coverage with HTML report
[testenv:coverage-html]
deps = {[testenv:coverage]deps}
commands = pytest --cov=agents --cov=orchestration --cov=utils --cov=scenarios --cov=dashboard --cov=mcp_servers --cov-report=html --cov-report=term-missing
